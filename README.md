
# IP Geolocation Map Project

## Overview

The IP Geolocation Map Project allows users to upload a log file containing IP addresses, process the IPs to map them to geographic regions, aggregate the data, and then manually upload the results as a CSV to Google My Maps for visualization. The project provides a simple interface for users to upload their IP data, process it, and view the aggregated regions on their custom Google Map.

## Features

- Upload a log file of IP addresses.
- Parse and process the IPs to identify their geographical regions.
- Aggregate the IPs by region and output the data in CSV format.
- Manual CSV upload to Google My Maps for geographic visualization.
- Users can embed their custom Google My Maps on the provided webpage.

## Project Structure

```
ip-geo-map/
├── uploads/                    # Temporary storage for uploaded log files (generated by multer)
├── outputs/                    # Directory where the generated CSV files are saved
├── views/
│   └── index.ejs               # EJS template for rendering the main page
├── map.html                    # HTML template for embedding the user’s Google My Map
├── regionCoordinates.js        # Module that exports the predefined coordinates for each region
├── server.js                   # Main server file containing all the logic
├── package.json                # Node.js project dependencies and scripts
└── node_modules/               # Installed Node.js modules (generated by npm)
```

## Installation

### Prerequisites

- **Node.js** (>=14.x)
- **npm** (comes with Node.js)
- **Google My Maps account** for embedding maps.

### Steps

1. **Clone the Repository:**
   ```bash
   git clone https://github.com/JiayiWu-MobilePractice/ip-geo-map.git
   cd ip-geo-map
   ```

2. **Install Dependencies:**
   ```bash
   npm install
   ```

3. **Run the Application:**
   ```bash
   npm start
   ```

4. **Open the Browser:**
   - Navigate to `http://localhost:3000/` to access the application.

## Usage

### Step 1: Upload a Log File

- On the homepage, click "Choose File" to select a `.txt` file containing IP addresses (one IP per line).
- Click the "Upload and Process" button to submit the log file for processing.

### Step 2: Download the Processed CSV

- After the log file is processed, a link will appear to download the CSV file containing the aggregated IP regions and their geographical coordinates.

### Step 3: Upload CSV to Google My Maps

1. Go to [Google My Maps](https://www.google.com/maps/d/u/0/).
2. Create a new map or open an existing map.
3. Click **Import** in the layer where you want to add your data.
4. Upload the CSV file that you downloaded from the application.
5. Map the columns to the correct fields in Google My Maps.

### Step 4: Embed the Map in `map.html`

1. After uploading the CSV to Google My Maps, click the **Share** button and select **Embed on my site** to get the embed link.
2. Open the `map.html` file in your project, and replace the `src` URL in the `<iframe>` with your map’s embed URL.

### Step 5: Access and Share Your Map

- Open `map.html` in a browser to see your embedded map.
- You can now share this page with others to display the geolocation of IPs.

## Technologies Used

- **Node.js**: Server-side JavaScript runtime.
- **Express.js**: Web framework for Node.js.
- **Multer**: Middleware for handling file uploads.
- **fast-geoip**: Library for IP-to-geolocation mapping.
- **EJS (Embedded JavaScript)**: Template engine for rendering dynamic web pages.
- **json2csv**: Converts JSON data to CSV format.
- **Google My Maps**: Used for geographic visualization.

## Example Use Case

1. **Upload IP Log File**: The user uploads a file containing a list of IPs.
2. **IP-to-Region Mapping**: The system processes the IPs, maps them to geographic regions using `fast-geoip`, and aggregates the data by region.
3. **CSV Generation**: The aggregated data is output as a CSV, allowing users to download and upload it to Google My Maps.
4. **Map Visualization**: The results are displayed on a Google Map, showing markers for each region where IPs are located.

## Challenges Faced

- **Handling Form Resubmission:** A form resubmission prompt appeared when refreshing the page after file upload. This was resolved by redirecting the user to a new route after processing, avoiding form re-submission.
- **Manual CSV Upload:** Users need to manually upload the generated CSV to Google My Maps, which adds an extra step but provides flexibility in map customization.
- **Accurate Geolocation:** Ensuring correct mapping of IPs to geographic regions, especially for Chinese IPs, was resolved by leveraging the `fast-geoip` library.

## Future Improvements

- **Automate Map Updates**: Automate the process of uploading the CSV to Google My Maps to streamline the workflow.
- **Enhanced Error Handling**: Improve error feedback to users for unsupported files or failed IP lookups.
- **Dynamic Mapping**: Implement real-time map updates directly on the application, reducing the need for manual Google My Maps updates.

## License

This project is licensed under the ISC License. See the LICENSE file for details.

## Author

- **Your Name** - [GitHub](https://github.com/JiayiWu-MobilePractice)
